<!-- templates/plant/plant-list.html -->
<div th:fragment="content">

    <!-- 상단 검색 바 -->
    <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
        <div class="flex flex-col md:flex-row gap-2 md:items-center">
            <div class="flex gap-2 items-center">
                <select class="border rounded-lg px-3 py-2 text-sm">
                    <option>발전소명</option>
                    <option>사이트ID</option>
                    <option>주소</option>
                </select>
                <input class="border rounded-lg px-3 py-2 text-sm w-full md:w-80"
                       placeholder="검색어를 입력하세요"/>
            </div>
            <div class="flex gap-2">
                <button class="px-4 py-2 rounded-lg bg-gray-800 text-white text-sm">조회</button>
                <button class="px-4 py-2 rounded-lg bg-gray-200 text-sm">초기화</button>
            </div>
        </div>
    </div>

    <!-- 카드 그리드 -->
    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5">

        <a th:each="p : ${plants}"
           th:href="@{|/plant/select/${p.id}|}"
           class="relative block bg-white border border-gray-200 rounded-2xl p-5
                  shadow-sm hover:shadow-md transition">

            <!-- 좌측 상태 컬러 바 -->
            <div class="absolute left-0 top-0 h-full w-1.5 rounded-l-2xl"
                 th:classappend="${p.anyIssue}
                   ? ' bg-amber-400'
                   : ' bg-emerald-400'">
            </div>

            <!-- 상단: 발전소명 + 종합 상태 -->
            <div class="flex items-start justify-between gap-3">
                <div>
                    <div class="text-lg font-bold text-gray-900"
                         th:text="${p.name}">발전소명</div>
                    <div class="text-sm text-gray-500 mt-1">
                        <span th:text="${p.siteCode}">00000000</span>
                        <span class="mx-2">•</span>
                        <span th:text="${p.address}">주소</span>
                    </div>
                </div>

                <span class="px-3 py-1 rounded-full text-xs font-semibold ring-1"
                      th:classappend="${p.anyIssue}
                        ? ' bg-amber-100 text-amber-700 ring-amber-300'
                        : ' bg-emerald-100 text-emerald-700 ring-emerald-300'"
                      th:text="${p.anyIssue} ? '확인 필요' : '정상 운전'">
                </span>
            </div>

            <!-- ✅ 제목 하단 메인 실선 (가장 강조) -->
            <div class="mt-3 h-[3px] w-full rounded-full"
                 th:classappend="${p.anyIssue}
                   ? ' bg-amber-400'
                   : ' bg-emerald-400'">
            </div>

            <!-- 상태 아이콘 (P M B C F) -->
            <div class="mt-4 flex items-center gap-2">

                <span class="inline-flex items-center justify-center w-9 h-9 rounded-full
                             text-sm font-bold ring-1"
                      th:classappend="${p.pcsFault}
                        ? ' bg-amber-200 text-amber-800 ring-amber-400'
                        : ' bg-emerald-200 text-emerald-800 ring-emerald-400'">P</span>

                <span class="inline-flex items-center justify-center w-9 h-9 rounded-full
                             text-sm font-bold ring-1"
                      th:classappend="${p.pvMeterZero}
                        ? ' bg-amber-200 text-amber-800 ring-amber-400'
                        : ' bg-emerald-200 text-emerald-800 ring-emerald-400'">M</span>

                <span class="inline-flex items-center justify-center w-9 h-9 rounded-full
                             text-sm font-bold ring-1"
                      th:classappend="${p.batteryAlarm}
                        ? ' bg-amber-200 text-amber-800 ring-amber-400'
                        : ' bg-emerald-200 text-emerald-800 ring-emerald-400'">B</span>

                <span class="inline-flex items-center justify-center w-9 h-9 rounded-full
                             text-sm font-bold ring-1"
                      th:classappend="${p.commDown}
                        ? ' bg-amber-200 text-amber-800 ring-amber-400'
                        : ' bg-emerald-200 text-emerald-800 ring-emerald-400'">C</span>

                <span class="inline-flex items-center justify-center w-9 h-9 rounded-full
                             text-sm font-bold ring-1"
                      th:classappend="${p.flowViolation}
                        ? ' bg-amber-200 text-amber-800 ring-amber-400'
                        : ' bg-emerald-200 text-emerald-800 ring-emerald-400'">F</span>

                <div class="ml-auto text-xs text-gray-500">
                    최종수신:
                    <span th:text="${p.lastSeen}">00:00:00</span>
                </div>
            </div>

            <!-- ✅ 아이콘 하단 보조 실선 -->
            <div class="mt-3 h-px w-full bg-gray-300"></div>

            <!-- 상태 설명 -->
            <div class="mt-3 text-xs min-h-[52px] leading-relaxed">

                <div th:if="${p.anyIssue}" class="text-amber-800 space-y-1">
                    <div>
                        <span class="font-semibold">상태 안내:</span>
                        <span th:text="${p.issueSummary}"></span>
                    </div>

                    <div th:if="${p.pvMeterZero}"
                         class="inline-flex items-center px-2 py-1 rounded-lg
                                bg-amber-50 text-amber-800 ring-1 ring-amber-300 text-[11px]">
                        현재 태양광 발전량이 없어 ESS 충전이 일시 중단됩니다
                    </div>
                </div>

                <div th:if="${!p.anyIssue}"
                     class="text-emerald-700 font-semibold flex items-center h-full">
                    모든 설비가 정상적으로 운전 중입니다
                </div>
            </div>

            <!-- 하단 수치 -->
            <div class="mt-4 grid grid-cols-3 gap-2 text-center">
                <div class="bg-gray-50 rounded-xl p-3">
                    <div class="text-xs text-gray-500">SOC</div>
                    <div class="text-base font-bold"
                         th:text="${p.soc + '%'}">0%</div>
                </div>
                <div class="bg-gray-50 rounded-xl p-3">
                    <div class="text-xs text-gray-500">태양광</div>
                    <div class="text-base font-bold"
                         th:text="${p.pvKw + ' kW'}">0 kW</div>
                </div>
                <div class="bg-gray-50 rounded-xl p-3">
                    <div class="text-xs text-gray-500">ESS</div>
                    <div class="text-base font-bold"
                         th:text="${p.essKw + ' kW'}">0 kW</div>
                </div>
            </div>

        </a>
    </div>

</div>
