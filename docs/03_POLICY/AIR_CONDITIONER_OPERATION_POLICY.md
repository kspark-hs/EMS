# AIR_CONDITIONER_OPERATION_POLICY.md

본 문서는 EMS에서 에어컨을 자동/수동으로 제어하기 위한  
**운전 판단 기준, 제어 흐름, 책임 경계**를 정의한다.

본 정책은 Service / Scheduler / Provider 구현의 **절대 기준 문서**이다.

---

## 1. 기본 철학

- 에어컨은 **배터리 룸 환경 유지 수단**이다.
- 에어컨 고장만으로 충·방전을 직접 중단하지 않는다.
- 단, **온습도 기준 이탈 시 충·방전은 반드시 중단**한다.
- EMS는 **AUTO 상태에서만** 에어컨 제어에 개입한다.
- MANUAL 상태에서는 EMS는 **절대 제어하지 않는다.**

---

## 2. 제어 모드 정의 (ControlMode)

### 2.1 AUTO

- EMS가 에어컨을 직접 제어
- 온습도 대표값 기준 자동 운전
- Scheduler에 의해 주기적으로 판단

조건:
- ControlMode = AUTO
- 통신 정상

---

### 2.2 MANUAL

아래 두 경우를 **모두 MANUAL**로 간주한다.

1. EMS UI에서 관리자가 MANUAL 선택 후 설정
2. 현장 엔지니어가 직접 에어컨을 조작한 경우

MANUAL 상태에서는:
- Scheduler 개입 ❌
- 자동 제어 ❌
- 상태 조회 및 UI 표기만 수행

---

## 3. 온습도 대표값 기준 (다채널)

온습도계가 복수 채널인 경우 다음 기준을 사용한다.

- 대표 최소 온도 = 모든 채널 중 **최소 온도**
- 대표 최대 온도 = 모든 채널 중 **최대 온도**
- 대표 습도 = 모든 채널 중 **최대 습도**

대표값은 AUTO 제어 판단에만 사용한다.

---

## 4. 자동 제어 기준 (AUTO 전용)

### 4.1 난방 제어

| 조건 | 동작 |
|----|----|
| 최소온도 ≤ 19℃ | HEAT ON / 설정 22℃ |
| 최소온도 ≥ 22℃ | FAN 전환 (LOW) |

---

### 4.2 냉방 제어

| 조건 | 동작 |
|----|----|
| 최대온도 ≥ 27℃ | COOL ON / 설정 25℃ |
| 최대온도 ≤ 24℃ | FAN 전환 (LOW) |

---

### 4.3 제습 제어

조건:
- 온도 안정 상태  
  (22℃ < 최소온도 AND 최대온도 < 27℃)

| 조건 | 동작 |
|----|----|
| 습도 ≥ 75% | DRY ON |
| 습도 ≤ 65% | FAN 전환 (LOW) |

---

## 5. FAN 대기 정책 (안전 기준)

- FAN(LOW)은 **안전한 대기 상태**
- 냉방 / 난방 / 제습 해제 후 기본 복귀 상태
- 불필요한 ON/OFF 반복 방지 목적

---

## 6. 혼합 운전 허용 정책 (중요)

- 동일 발전소 내 에어컨은
    - 냉방 / 난방 **혼합 운전이 현실적으로 발생할 수 있다**
- 이는 다음 목적을 위한 **정상 운전 상태**이다.
    - 결로 방지
    - 단열 불균형 대응
    - 랙 국부 발열 대응

### 표현 원칙

- 혼합 운전에 대한 **별도의 요약 문구는 제공하지 않는다**
- 혼합 여부는 **에어컨 상세 테이블**을 통해서만 확인 가능하다
- 요약 카드에서는 **선택된 에어컨 1대의 운전 상태만 표시**한다

⚠️ 혼합 운전은 고장·경고·이상 상태가 아니다  
⚠️ Scheduler는 각 에어컨을 **개별적으로 판단**한다


---

## 7. 통신 장애 처리

### 7.1 에어컨 통신 불가

- 해당 에어컨 제어 중단
- 충·방전 즉시 중단 ❌
- 충·방전 여부는 온습도계 상태에 의해 판단

---

### 7.2 온습도계 통신 불가

- 충·방전 **즉시 중단**
- 에어컨 AUTO 제어 중단
- MANUAL 상태는 유지 (개입 없음)

---

## 8. 책임 경계 (중요)

- Provider  
  → 하드웨어 제어 / 상태 조회만 담당

- Service  
  → 판단 로직  
  → AUTO vs MANUAL 분기  
  → 대표값 계산

- Scheduler  
  → 주기적 autoControlIfNeeded 실행  
  → AUTO 상태에서만 동작

- UI  
  → 상태 표현만 담당  
  → 판단 로직 포함 금지

---

## 9. 구현 체크리스트

- [x] ControlMode.AUTO / MANUAL 분기
- [x] MANUAL 상태 EMS 개입 차단
- [x] 다채널 온습도 대표값 사용
- [x] FAN 대기 정책 적용
- [x] 혼합 운전 허용 구조
- [x] Scheduler 주기 실행
- [ ] Provider 실 메모리맵 연동
- [ ] DB 기준값 연동

---

본 문서와 충돌하는 임의의 제어 로직은 허용하지 않는다.
