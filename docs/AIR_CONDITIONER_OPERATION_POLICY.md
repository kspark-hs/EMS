# AIR_CONDITIONER_OPERATION_POLICY.md

본 문서는 EMS에서 에어컨을 자동/수동으로 제어하기 위한
**운전 판단 기준 및 책임 경계**를 정의한다.

본 정책은 Service / Scheduler / Provider 구현의 기준 문서이다.

---

## 1. 기본 철학

- 에어컨은 **배터리 룸 환경 유지 수단**이다.
- 에어컨 고장만으로 충방전을 직접 중단하지 않는다.
- 단, **온습도 기준 이탈 시 충방전은 반드시 중단**한다.
- EMS는 AUTO 상태에서만 에어컨을 제어한다.

---

## 2. 제어 모드 정의 (ControlMode)

### AUTO
- EMS가 에어컨을 직접 제어
- 온습도 기준 기반 자동 운전
- Scheduler에 의해 주기적으로 판단

### MANUAL
아래 두 경우를 **모두 MANUAL**로 간주한다.

1. EMS UI에서 관리자가 MANUAL 선택 후 설정
2. 현장 엔지니어가 직접 에어컨을 조작한 경우

> MANUAL 상태에서는 EMS는 **절대 개입하지 않는다.**

---

## 3. 온습도 대표값 기준 (다채널)

- 대표 최소 온도 = 모든 채널 중 **최소 온도**
- 대표 최대 온도 = 모든 채널 중 **최대 온도**
- 대표 습도 = 모든 채널 중 **최대 습도**

---

## 4. 자동 제어 기준 (AUTO 전용)

### 4.1 난방 제어

| 조건 | 동작 |
|----|----|
| 최소온도 ≤ 19℃ | HEAT ON / 설정 22℃ |
| 최소온도 ≥ 22℃ | FAN 전환 (LOW) |

---

### 4.2 냉방 제어

| 조건 | 동작 |
|----|----|
| 최대온도 ≥ 27℃ | COOL ON / 설정 25℃ |
| 최대온도 ≤ 24℃ | FAN 전환 (LOW) |

---

### 4.3 제습 제어

- 조건: 온도 안정 상태  
  (22℃ < 최소온도 AND 최대온도 < 27℃)

| 조건 | 동작 |
|----|----|
| 습도 ≥ 75% | DRY ON |
| 습도 ≤ 65% | FAN 전환 (LOW) |

---

## 5. FAN 대기 정책 (안전 기준)

- FAN(LOW)은 **안전한 대기 상태**
- 난방/냉방/제습 해제 후 기본 복귀 상태
- 불필요한 ON/OFF 반복 방지 목적

---

## 6. 통신 장애 처리

### 에어컨 통신 불가
- 에어컨 제어 중단
- 충방전 즉시 중단 ❌
- 온습도 상태에 따라 충방전 여부 결정

### 온습도계 통신 불가
- 충방전 **즉시 중단**
- 에어컨 자동제어 중단

---

## 7. 책임 경계 (중요)

- Provider  
  → 하드웨어 제어 / 상태 조회만 담당

- Service  
  → 판단 로직 / AUTO vs MANUAL 분기

- Scheduler  
  → 주기적 autoControlIfNeeded 실행

- UI  
  → 상태 표현만 담당 (판단 없음)

---

## 8. 구현 체크리스트

- [x] ControlMode.AUTO / MANUAL 분기
- [x] 다채널 온습도 대표값 사용
- [x] FAN 대기 정책 적용
- [x] Scheduler 주기 실행
- [ ] Provider 실 메모리맵 연동
- [ ] DB 기준값 연동

---

본 문서와 충돌하는 임의의 제어 로직은 허용하지 않는다.
