# UI CONTRACT (DO NOT CHANGE)

본 문서는 ESS EMS UI의 **절대 기준(Contract)** 이다.  
본 문서 수정 없이는 **UI 구조/카드 타입/페이지 단계** 변경을 허용하지 않는다.

- 기준 페이지(Reference): **PCS, 배터리, PV 전력량계**
- 참고: 발전소 리스트는 현재 **프레임 좌표계(상단 네비/여백/제목 위치)** 정렬이 완료되지 않아 기준 페이지로 사용하지 않는다.
    - 단, 카드 콘텐츠(정보 구조)는 대부분 확정된 상태이며
    - 프레임 정렬 후 **최종 디자인 검토 1회**로 완료 가능하다.

---

## 1. 공통 카드 타입 (고정)

모든 설비 페이지는 아래 카드 타입 중 일부만 사용한다.

1. SummaryCard         (요약 카드)
2. OperationStatusCard (운전 상태 카드)
3. FaultStatusCard     (고장 상태 카드)
4. StatusTableCard     (상태 테이블 카드)
5. DetailCard          (상세 카드)

- 카드 병합 금지 ❌
- 카드 의미 변경 금지 ❌
- UI_CONTRACT에 없는 카드 타입을 코드에서 생성 금지 ❌

---

## 1-1. 신규 카드 타입 생성 규칙 (확장 규칙)

신규 카드 타입 생성은 가능하나, 반드시 **UI_CONTRACT.md에 선행 정의**되어야 한다.

선행 정의에는 아래 항목이 반드시 포함되어야 한다.
- 카드 타입 이름
- 생성 목적
- 적용 대상 페이지
- 포함 항목(필드)

정의되지 않은 카드 타입은 코드에서 생성할 수 없다.  
(코드 선행 생성 허용하지 않음)

---

## 2. 페이지 공통 구조 (고정)

모든 설비 페이지는 아래 단계 순서를 따른다.

[Summary]
[OperationStatus]
[FaultStatus]
[StatusTable]
[Detail]

- 순서 변경 금지 ❌
- 누락은 허용 ✅
- 추가 단계 신설 불가 ❌

---

## 2-1. 디바이스별 UI 기준 (고정)

본 UI는 디바이스 유형에 따라 레이아웃 동작 기준을 명확히 구분한다.

### PC (Desktop)
- 기준 해상도: ≥ 1024px
- 사이드바: 항상 고정 표시
- 상단 네비게이션 + 사이드바 + main 영역 동시 노출
- Hover 기반 인터랙션 허용
- FAB 사용 금지

### 태블릿 (Tablet)
- 기준 해상도: 768px ~ 1023px
- 사이드바: 기본 숨김
- FAB 버튼을 통한 사이드바 토글
- Hover 미사용, Click 기준 인터랙션
- main 영역은 전체 폭 사용

### 모바일 (Mobile)
- 기준 해상도: < 768px
- 사이드바: Drawer 방식
- FAB 버튼 필수
- 카드 단위 세로 스택 고정
- 페이지 내 다단 레이아웃 금지

---

## 2-2. 장비 선택 UI 구조 원칙 (고정)

모든 장비 선택 UI는 단일 상태 변수(selectedXXXId)로 통합 관리한다.

- 선택 UI는 3단계 패턴으로 통일한다.
  [선택 UI] → [selectedXXXId] → [하위 카드 렌더링]

- 선택 UI 방식(select, table 등)은 장비 특성에 따라 달라질 수 있으나,
  상태 변수 구조는 변경할 수 없다.

- selectedXXXId는 해당 페이지의 모든 하위 카드에서 공통 참조 값으로 사용한다.

---

## 3. OperationStatusCard 표준 항목 (고정)

| 항목 | 설명 |
|---|---|
| actionStatus | 동작 상태 |
| operationStatus | 운전 상태 |
| operationMode | 운전 모드 |
| controlMode | 제어 모드 |
| description | 보조 설명 |

- 없는 항목은 "-" 표시
- 문자열 하드코딩 금지
- label은 enum / ViewDto에서만 처리

---

## 4. 색상 규칙 (고정)

- 정상 / 운전 중 / 활성 상태 → green
- 경고 / 제한 상태 → amber
- 고장 / 비정상 상태 → red

---

## 5. 수치 표현 규칙 (고정)

모든 수치 데이터는 아래 원칙을 따른다.

- 전력(kW), 에너지(kWh), 전압(V), 전류(A) → 소수점 2자리 (0.00)
- 퍼센트(%), 온도(℃) → 소수점 1자리 (0.0)
- 주파수(Hz) → 정수
- 상태/모드 → 숫자 코드 노출 금지 (문자열 + 색상)

본 규칙은 모든 카드/페이지/설비에 동일 적용한다.

---

## 5-1. 카드 유형별 수치 정밀도 원칙 (고정)

- SummaryCard / OperationStatusCard
    - 목적: 한눈에 상태 파악
    - 원칙: 과도한 정밀도 표시 금지
    - 기본: 소수점 2자리 (요약 기준)

- DetailCard
    - 목적: 계측/분석
    - 원칙: 장비 메모리맵 기준 최대 정밀도 허용
    - 단, UI 과밀 방지를 위해 소수점 2자리를 기본으로 한다.

---

## 6. 변경 규칙 (고정)

본 문서 수정 없이 아래 변경을 금지한다.
- UI 구조 변경 ❌
- 카드 타입 변경 ❌
- 단계 수 변경 ❌

변경 제안은 반드시 아래 섹션에만 기록한다.

---

## 장비 식별자 표기 규칙 (공통)

- 장비 식별은 UI에서 단순 번호 표기만 사용한다.
- 형식: `#1`, `#2`, `#3` …
- 페이지 타이틀이 이미 장비 종류를 포함하므로,
  카드/테이블 내에서는 장비 타입명(PV 전력량계, PCS, 배터리 등)을 반복하지 않는다.

### 적용 예
- PCS 페이지: `#1`, `#2`
- 배터리 Rack: `#1`, `#3`
- PV 전력량계: `#1`

---

## PV 전력량계 상태 카드

- 목적: PV 실측 발전 상태를 한눈에 파악하기 위함
- 기준 데이터:
    - 상태 (NORMAL / FAULT / DISCONNECTED)
    - 출력전력 (PV 실측 발전량) ⭐ 최우선
    - 계통 유효전력
    - 주파수
    - 데이터 시각 (RTU 수집 시각 기준)

### 데이터 시각 기준
- RTU가 전력량계(Meter) 값을 정상적으로 읽어온 시각을 기준으로 한다.
- DB 저장 시각, 서버 처리 시각은 UI 기준 시각으로 사용하지 않는다.

---

## PV 전력량계 DetailCard (PC 기준)

- 카드 배치: 2행 × 2열
  [전압 | 전류]
  [전력 | 기타]

- 전압 박스:
    - 내부 레이아웃은 4행 × 4열(라벨+값 × 2쌍)을 사용한다.
    - 라벨–값은 컬럼 정렬로 표현하며 띄어쓰기/가변 여백을 사용하지 않는다.

- 전류/전력/기타:
    - 기본은 라벨+값 × 2쌍 컬럼을 사용한다.
    - 항목 수가 적을 경우 높이 균형을 위해 예비 슬롯을 유지할 수 있다.

---

## PCS Fault Card 역할 정의 (확정)

### FaultStatusCard (PCS 고장 상태 카드)
- 목적: PCS 단위의 고장 요약 상태 표시
- 포함 항목:
    - 고장 발생 여부
    - 내부 통신 상태 (PCS ↔ RTU)
    - 외부 통신 상태 (RTU ↔ EMS)
    - 인터록 상태
- 특징:
    - 개별 Fault Bit 미표시
    - 운전 판단용 요약 카드

### DetailCard – Fault Detail (PCS 고장 상세 카드)
- 목적: 선택된 PCS 기준 고장 상세 표시
- 기준:
    - PCS 메모리맵 기준 Fault 항목
    - PcsFaultType enum을 단일 기준으로 사용
- 특징:
    - PCS 선택(select) 변경 시 GET 방식 페이지 이동
    - Battery Rack Fault Detail Card와 동일 UX

---

## Fault Type 기준 (공통)

- 고장 항목의 단일 기준은 각 장비별 FaultType enum이다.
- Modbus Memory Map의 개별 bit는 UI에 직접 노출하지 않는다.
- 다수 bit는 의미 단위 Fault로 OR 집계하여 표현한다.
- UI 노출 여부는 enum의 uiVisible 속성으로 제어한다.

---

### Battery / Rack Fault 카드 UI 차이

#### Battery 고장정보 카드
- 배터리 단위 고장 표시
- 배터리 선택 select 없음
- 현재 선택된 배터리 기준으로 고장 정보 표시

#### Rack 고장정보 카드
- Rack 단위 고장 표시
- Rack 선택 select 반드시 포함
- 배터리 컨텍스트는 유지하고 rackNo만 변경
### Battery / Rack Fault 카드 UI 차이

#### Battery 고장정보 카드
- 배터리 단위 고장 표시
- 배터리 선택 select 없음
- 현재 선택된 배터리 기준으로 고장 정보 표시

#### Rack 고장정보 카드
- Rack 단위 고장 표시
- Rack 선택 select 반드시 포함
- 배터리 컨텍스트는 유지하고 rackNo만 변경

---


## PV 전력량계 트렌드 페이지 UI 규칙 (고정)

### 목적
- PV 실측 발전 상태를 **시간 흐름 기준으로 분석**하기 위함
- 현재 상태(Summary/Status)와 **완전히 분리된 분석 전용 영역**

---

### 트렌드 그래프 구성 (고정)

- 시간축: **24시간 고정 (00:00 ~ 23:59)**
- 기준 문서:
    - TREND_DATA_POLICY.md
    - PV_PVMETER_PROVIDER_POLICY.md

#### 필수 트렌드 항목
- Active Power (실측 발전 전력) ⭐ 필수

#### 선택 트렌드 항목 (확장 가능)
- 누적 발전량(Energy)
- 계통 유효전력

---

### 데이터 표시 규칙 (절대)

- 시간축 재계산 금지 ❌
- 최근 N건 기반 그래프 생성 금지 ❌
- NULL 데이터:
    - 보정 ❌
    - 연결 ❌
    - 0 처리 ❌
    - **그래프 단절(끊김)으로 표현**

- 야간 시간대(NULL)는 **정상 상태로 간주**

---

### 상태(Event / Warning) 표시 규칙

- 상태는 트렌드 값과 **분리된 오버레이 정보**
- 표현 방식:
    - 그래프 상 마커(marker)
    - 색상 기준은 UI_STATUS_COLOR_POLICY.md 참조

> 트렌드 값 자체를 상태로 해석하지 않는다.

---

## 환경 조건(온습도) UI 표시 규칙 (고정)

### 기본 원칙

- 온습도 상태는 **환경 조건(Environment Condition)** 이다.
- Battery / PCS의 OperationStatus와 **절대 연동하지 않는다**.
- 환경 조건을 이유로 장비 상태 색상 변경 금지 ❌

---

### UI 표시 위치

- 환경 조건은 다음 위치에만 표시한다.
    - 페이지 상단 보조 정보 영역
    - 또는 SummaryCard 하단 보조 문구 영역

❌ OperationStatusCard 내부 표시 금지  
❌ FaultStatusCard와 혼합 금지

---

### 표시 문구 (고정)

| 환경 상태 | 표시 문구 |
|---|---|
| 기준 만족 | 충방전 운전 가능 |
| 기준 이탈 | 충방전 운전 불가 |
| 데이터 수신 불가 | 충방전 운전 불가 (환경 확인 불가) |

- 문구 외 추가 해석 금지
- 색상/아이콘은 UI_STATUS_COLOR_POLICY.md 기준만 사용

---

## 7. Battery / Rack 고장정보 UI 정책

### 7-1. 화면 구성 원칙

- [배터리 고장정보] 카드
- [Rack 고장정보] 카드

두 영역은 **화면에서 분리하여 동시에 표현한다.**

### 7-2. 데이터 소스

- 두 화면은 모두
  BatteryFaultDetailService 결과를 사용한다.
- Rack 고장정보는
  선택된 rackNo 기준 필터링 결과만 표시한다.

### 7-3. UX 이동 규칙

- Rack 상태 카드에서 Rack 클릭 시
  → Rack 고장정보 카드로 이동한다.
- Rack 고장정보 카드 상단의 Rack 선택 Select는 유지한다.

### 7-4. 주의 사항

- Rack 고장정보 화면은
  Battery 고장정보의 축약/대체 화면이 아니다.
- UI 분리는 유지하되,
  데이터 구조는 단일화한다.

---

### 🔧 소방설비 카드 섹션에 추가

```md
### 소방설비 카드 (Fire System)

- 카드 수: 1
- View DTO: FireSystemStatusTableViewDto
- 색상 판단 기준:
  - rows[0].status == NORMAL → green
  - 그 외 → red
- 통신 단절(DISCONNECTED)은 반드시 **red**로 표시한다.

---

## NEXT_VERSION (논의용, 미적용)

- (비워 둠)

## Related Documents
- OPERATION_POLICY.md
- SERVICE_LAYER_POLICY.md

---

