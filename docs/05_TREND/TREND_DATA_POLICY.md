# TREND_DATA_POLICY.md

본 문서는 EMS에서 사용되는 **모든 트렌드 데이터(Time-Series Data)** 의  
시간축 기준, 샘플링 규칙, UI 표시 원칙을 정의한다.

본 문서는 다음 문서들과 함께 **단일 기준(Single Source of Truth)** 으로 사용된다.

- OPERATION_POLICY.md
- DEVICE_PROVIDER_COMMON_POLICY.md
- UI_CONTRACT.md

---

## 1. 목적

본 정책은 다음 목적을 가진다.

- 장비별 트렌드 데이터의 **시간축 기준 통일**
- Provider / Service / UI 간 **역할 혼선 방지**
- 성능 저하 없이 **일관된 트렌드 UX 제공**
- “최근 N건” 기반 설계로 인한 **시간 왜곡 방지**

---

## 2. 적용 대상

본 정책은 다음 장비의 트렌드 데이터에 **공통 적용**한다.

- PV 전력량계
- PCS
- ESS 전력량계
- 배터리 (전압 / 전류 / SOC 등)
- 온습도계

> 장비별 특화 항목은 각 Provider Policy 문서에서 정의한다.

---

## 3. 시간축 기준 (절대 규칙)

### 3.1 기본 시간축

- 모든 트렌드 데이터의 시간축은 **24시간 기준**을 따른다.
- 기준 범위:
    - `00:00:00 ~ 23:59:59`
- 날짜 단위 조회 시:
    - 특정 날짜(LocalDate)에 **고정된 24시간 축**을 생성한다.

> ❗ “최근 N건” 기준 트렌드 생성 **금지**

---

### 3.2 데이터 없음(NULL) 처리

- 해당 시간대에 데이터가 없는 경우:
    - 값은 **NULL** 로 유지한다.
- NULL은 다음을 의미할 수 있다.
    - 야간 시간대(PV)
    - 통신 지연
    - 장비 정지
    - RTU 미수신

> NULL ≠ FAULT  
> NULL은 **상태 판단의 근거가 아닌 데이터 상태**이다.

---

## 4. 샘플링 기준

### 4.1 기본 샘플링 단위

| 구분 | 기본 샘플링 |
|----|----|
| UI 트렌드 표시 | 5분 |
| 일간 트렌드 | 24시간 × 5분 |
| Raw 데이터 | Provider 내부 전용 |

- Provider는 Raw 데이터를 그대로 노출하지 않는다.
- UI / Service에는 **샘플링된 데이터만 전달**한다.

---

### 4.2 Down-Sampling 원칙

- 표시 해상도가 낮은 경우:
    - 평균값 / 마지막 값 중 **장비 특성에 따라 선택**
- Down-Sampling 기준은:
    - Provider 또는 Service 계층의 책임
    - UI에서 계산 금지

---

## 5. Provider 책임

Provider는 다음 책임을 가진다.

- 24시간 시간축 생성
- 시간축 기준 데이터 매핑
- 누락 구간 NULL 유지
- 장비 특성에 맞는 샘플링 수행

Provider는 다음을 **절대 수행하지 않는다**.

- UI 표시용 축 변형
- 스크롤 / 페이징 로직 구현
- 상태 색상 판단

---

## 6. Service 책임

Service 계층은 다음 책임을 가진다.

- 트렌드 조회 기간 검증
- 다중 Provider 결과 병합
- 상태(Event / Fault) 오버레이 판단
- UI 요청에 따른 범위 제한

---

## 7. UI 적용 원칙

### 7.1 UI의 역할

UI는 다음만 수행한다.

- 전달받은 시간축 그대로 표시
- NULL 데이터는 공백 또는 끊김으로 표현
- 상태(Event / Warning)는 **마커 형태로 표시**

UI는 다음을 **절대 수행하지 않는다**.

- 시간축 재계산
- 누락 데이터 보정
- 평균 / 합계 계산

---

### 7.2 표시 포인트 제한

- UI 단일 그래프 최대 표시 포인트 수: **288개**
    - (24시간 × 5분)
- 스크롤 또는 줌은 **차후 확장 기능**으로 분리한다.

---

## 8. 테이블(표) 트렌드 정책

### 8.1 테이블의 성격

- 테이블 트렌드는 **요약/점검용**
- 전체 24시간을 모두 표시하지 않는다.

### 8.2 기본 표시 기준

| 항목 | 기준 |
|----|----|
| 기본 행 수 | 12 |
| 정렬 | 최신 시간 → 과거 |
| 스크롤 | 허용 |

> “최근 12건”은  
> **UI 편의 기준**이며  
> 시간축 기준 설계와 충돌하지 않는다.

---

## 9. 상태(Event / Warning) 트렌드 연계

- 상태 정보는 트렌드 값과 **분리된 오버레이 정보**로 취급한다.
- 예:
    - WARNING 발생 시
        - 그래프 상 마커
        - 테이블 상태 컬럼 표시

> 트렌드 값 자체를 상태로 해석하지 않는다.

---

## 10. 금지 사항 (중요)

다음 설계는 **전면 금지**한다.

- 최근 N건 기준으로 그래프 생성
- 장비별 서로 다른 시간축 사용
- UI에서 트렌드 재가공
- Provider마다 다른 샘플링 기준 적용

---

## 11. 확장 계획

- 1분 / 15분 / 1시간 샘플링은 **확장 옵션**
- 실시간 스트리밍 트렌드는 별도 정책 문서로 분리한다.

---

## 12. 변경 이력

- 2026-01-01
    - 트렌드 데이터 공통 정책 초안 작성
    - 24시간 시간축 기준 명문화
    - UI / Provider / Service 책임 분리 명확화

---

## Related Documents

- OPERATION_POLICY.md
- DEVICE_PROVIDER_COMMON_POLICY.md
- PV_PVMETER_PROVIDER_POLICY.md
- UI_CONTRACT.md
