# TEMPERATURE_HUMIDITY_MODEL.md

본 문서는 EMS에서 사용되는 **온습도계 모델 및 판단 기준**을 정의한다.  
온습도계는 배터리 룸 환경을 감시하기 위한 **유일한 판단 근거 장비**이며,  
충·방전 운전 가능 여부는 본 문서의 기준에 따라 결정된다.

---

## 1. 온습도계의 역할

- 배터리 룸의 **온도 / 습도 상태를 실시간 감시**
- 충·방전 운전 가능 여부 판단의 **최종 입력 데이터**
- 에어컨, 환기 설비 등 제어 수단의 상태와 **직접적인 연관 없음**

> EMS는 에어컨을 신뢰하지 않고  
> 오직 온습도계가 보고하는 “환경 결과”만을 신뢰한다.

---

## 2. 채널 구조 (n-Channel 지원)

온습도계는 다채널 구조를 가질 수 있다.

| 채널 수 | 구성 |
|------|------|
| 1ch | 온도 센서 1 + 습도 센서 1 |
| 2ch | 온도 센서 2 + 습도 센서 2 |
| n ch | 온도 센서 n + 습도 센서 n |

각 채널은 동일한 배터리 룸 내 서로 다른 위치를 측정할 수 있다.

---

## 3. 대표값 선정 규칙 (중요)

다채널 온습도계의 경우, EMS는 **가장 보수적인 값**을 사용한다.

- 대표 온도 = **모든 채널 중 최대 온도, 최소 온도**
- 대표 습도 = **모든 채널 중 최대 습도**

이는 배터리 룸 내 국부적 과열·고습 상황을 감지하기 위함이다.

---

## 4. 기준값 (관리자 설정 가능)

기본 기준값은 다음과 같으며, 발전소별로 변경될 수 있다.

- 온도 기준: **18 ℃ ~ 28 ℃**
- 습도 기준: **≤ 80 %**

기준값은 관리자 설정 항목이며,
EMS는 설정된 기준을 그대로 적용한다.

---

## 5. 충·방전 운전 판단 규칙 (절대 규칙)

다음 조건 중 **하나라도 만족**하면 충·방전은 즉시 중단된다.

1. 온습도계 데이터 수신 불가
    - 통신 불가
    - 값 NULL
    - 수신 지연 / 타임아웃

2. 대표 온도가 기준 범위를 벗어난 경우

3. 대표 습도가 기준 범위를 초과한 경우

> 환경을 확인할 수 없는 상태는  
> 가장 보수적으로 판단하여 충·방전을 허용하지 않는다.

---

## 6. 에어컨과의 관계

- 에어컨 상태(고장, 통신 불가, 수동 모드 등)는
  **충·방전 판단에 직접적인 영향을 주지 않는다**
- 단, 에어컨 문제로 인해 온습도가 기준을 벗어나면
  **온습도 기준에 의해 충·방전은 중단된다**

---

## 7. UI 표현 원칙

| 상태 | UI 문구 | 색상 |
|---|---|---|
| 기준 범위 내 | 충방전 운전 가능 | 🟢 |
| 기준 이탈 | 충방전 운전 불가 | 🔴 |
| 데이터 수신 불가 | 충방전 운전 불가 (환경 확인 불가) | 🔴 |

본 문서는 UI, Service, 제어 로직에서 **동일한 기준으로 참조**된다.

---

## 온습도계 Provider 구조

- TemperatureHumidityProvider : Contract
- SinwooTemperatureHumidityProvider : 신우시엠 구현체

제조사별 / 모델별 차이는 Provider 내부에서 처리한다.

---

## 운전 가능 판단 기준

- 온도 범위: 18.0 ~ 28.0 ℃
- 습도 상한: ≤ 80 %

기준값은 Service에서 해석되며,
향후 관리자 설정으로 변경 가능하도록 설계한다.

---

## 8. Temperature / Humidity Status Table (v1.0)

### 8.1 Status 판단 enum

- NORMAL
- WARNING
- FAULT
- DISCONNECTED

색상 정책:
- NORMAL → green
- WARNING / FAULT / DISCONNECTED → red
  (UI_STATUS_COLOR_POLICY.md 참조)

---

### 8.2 판단 기준 (임시 기준값)

- 온도
    - Min: 18.0 ℃
    - Max: 28.0 ℃
- 습도
    - Max: 80.0 %

※ 본 기준은 Provider 내부 상수로 관리  
※ 관리자 모드에서 설정 가능하도록 확장 예정

---

### 8.3 상태 판단 로직

1. 통신 단절
    - temperature == null OR humidity == null
      → DISCONNECTED

2. 기준 초과
    - temperature > 기준온도Max OR humidity > 기준습도Max
      → WARNING

3. 그 외
   → NORMAL

---

### 8.4 충방전 운전 가능 여부 (operable)

operable =
- 통신 정상
- 온도 ∈ [기준온도Min, 기준온도Max]
- 습도 ≤ 기준습도Max

표시 문구:
- true  → "충방전 운전가능"
- false → "충방전 운전불가"

---

# TEMPERATURE_HUMIDITY_MODEL.md

본 문서는 EMS에서 사용되는 **온습도계(Temperature / Humidity Sensor) 상태 모델과 운전 판단 기준**을 정의한다.  
온습도계는 **배터리 룸 환경 판단의 1차 기준 설비**이며,  
충·방전 운전 가능 여부 판단에 **직접적인 영향을 미친다.**

본 문서는 UI, Backend(Service / Provider), Scheduler, 제어 로직에서  
**동일한 의미로 사용되는 단일 기준(Single Source of Truth)** 이다.

---

## 9. 적용 범위

본 모델은 다음 대상에 적용된다.

- 온습도계 상태 카드 (요약 / 상세)
- 배터리 충·방전 운전 가능 여부 판단
- 에어컨 자동 제어 판단의 입력 조건
- 알람 / 로그 / 이력 기록 기준

---

## 10. 온습도계 채널 구성

- 온습도계 1대는 **다중 채널(CH 1 ~ N)** 을 가질 수 있다.
- 각 채널은 **독립적인 측정값과 통신 상태**를 가진다.
- 채널 단위 상태는 **참고 정보**이며,  
  **운전 판단은 “전체 채널 집계 결과”를 기준으로 한다.**

---

## 11. 채널 단위 상태 정의 (Row Status)

| 상태 코드 | 상태 텍스트 | 의미 |
|---------|------------|------|
| NORMAL | 정상 | 온도·습도 모두 기준 범위 내 |
| WARNING | 고온 | 온도 > 기준 최대 |
| WARNING | 저온 | 온도 < 기준 최소 |
| WARNING | 과습 | 습도 > 기준 최대 |
| DISCONNECTED | 판단 불가 | 해당 채널 데이터 수신 불가 |

### ⚠️ 상태 표현 원칙

- **“주의”라는 추상적 표현은 사용하지 않는다**
- 원인을 즉시 인지할 수 있도록  
  `고온 / 저온 / 과습 / 판단 불가` 로 **명확히 표현한다**
- 통신 단절 채널은 **환경 판단에서 제외**된다

---

## 12. 기준값 정의

| 항목 | 기준 |
|----|----|
| 온도 최소 | 기준온도Min |
| 온도 최대 | 기준온도Max |
| 습도 최대 | 기준습도Max |

- 습도는 **최소값 판단을 하지 않는다**
- 습도 0%는 **현실적으로 발생하지 않는 값**으로 판단 대상에서 제외한다

---

## 13. 전체 채널 집계 판단 (Overall Status)

### 13.1 채널 생존 판단

- **하나라도 통신 정상 채널이 존재하면**
    - 환경 정보는 **수신 가능** 상태로 판단
- **모든 채널이 통신 불가인 경우**
    - 환경 정보 **수신 불가**
    - 충·방전 **무조건 정지**

---

### 13.2 환경 이상 판단 로직

다음 조건 중 **하나라도 만족하면** 환경 이상으로 판단한다.

- 정상 통신 채널 중
    - 온도 < 기준온도Min
    - 온도 > 기준온도Max
    - 습도 > 기준습도Max

➡️ **채널 개수와 무관하게 1개라도 기준 초과 시 즉시 정지**

---

## 14. 운전 판단 정책 (Operable)

| 조건 | 충·방전 |
|----|----|
| 모든 채널 통신 불가 | ❌ 운전 정지 |
| 기준 초과 채널 존재 | ❌ 운전 정지 |
| 정상 통신 + 기준 만족 | ✅ 운전 가능 |

- 운전 정지 시 UI 표기
    - **“충·방전 운전정지”**
- 정지 사유는 상태 텍스트로 명확히 표현한다  
  (예: 환경 이상, 환경 정보 수신 불가)

---

## 15. 대표 표시 값 산정 규칙 (요약 카드)

요약 카드에 표시되는 온·습도 값은 **가장 위험한 값 기준**으로 산정한다.

| 항목 | 대표값 기준 |
|----|----|
| 온도 | 정상 통신 채널 중 **최대 온도** |
| 습도 | 정상 통신 채널 중 **최대 습도** |

- 평균값, 임의 채널 값은 사용하지 않는다
- **운영 판단 관점에서 가장 보수적인 값만 표시한다**

---

## 16. UI 표현 원칙

### 요약 카드
- 상태:
    - 정상
    - 환경 이상 (충·방전 정지)
    - 환경 정보 수신 불가
- 온도 / 습도: 대표값 기준

### 상세 테이블
- 채널별 상태 원인 명확 표시
- 통신 단절은 “판단 불가”로 표현

---

## 17. 관련 문서

- ENVIRONMENT_POLICY.md
- OPERATION_POLICY.md
- AIR_CONDITIONER_OPERATION_POLICY.md
- UI_STATUS_COLOR_POLICY.md

---

## 18. 변경 이력

### v1.0 (2026-01-02)
- 다중 채널 온습도계 상태 모델 확정
- 원인 기반 상태 텍스트 도입 (고온 / 저온 / 과습)
- 충·방전 정지 판단 기준 확정
- 대표값 산정 규칙 명문화
